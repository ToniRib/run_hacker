<%= javascript_tag do %>
  $(function () {
    $('#temperature-chart').highcharts({
        chart: {
            type: 'scatter',
            zoomType: 'xy',
            height: 570
        },
        xAxis: {
            title: {
                enabled: true,
                text: 'Temperature (°F)'
            },
            startOnTick: true,
            endOnTick: true,
            showLastLabel: true
        },
        title: { text: null },
        yAxis: {
            title: {
                text: null
            }
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            scatter: {
                marker: {
                    radius: 5,
                    states: {
                        hover: {
                            enabled: true,
                            lineColor: 'rgb(100,100,100)'
                        }
                    }
                },
                states: {
                    hover: {
                        marker: {
                            enabled: false
                        }
                    }
                },
                tooltip: {
                    headerFormat: '<b>{series.name}</b><br>',
                    pointFormat: '{point.x} °F, {point.y} min'
                }
            }
        },
        series: [{
            color: 'rgba(223, 83, 83, .5)',
            data: null
        }]
    });
  });

  <!-- DYNAMIC CHART -->
  $('#create-temperature-chart').on('click', function() {
    var $chart = $('#temperature-chart').highcharts()
    var minDistance = parseInt($('#minimum_distance').val());
    var maxDistance = parseInt($('#maximum_distance').val());

    var minDistanceInMiles = minDistance * (1000 / 0.621371);
    var maxDistanceInMiles = maxDistance * (1000 / 0.621371);

    var range = minDistance.toString() + ' - ' + maxDistance.toString() + ' mile ';
    var yAxisSelection = $('#y-axis').val();

    $chart.setTitle({ text: 'Temperature vs. ' + yAxisSelection + ' for ' + range + 'runs' })
    $chart.yAxis[0].setTitle({
        text: yAxisSelection
    });

    var workouts = <%= @workouts.distance_temperature_and_total_time %>;
    var filtered = [];

    workouts.forEach(function(set){
      if (set[0] >= minDistanceInMiles && set[0] <= maxDistanceInMiles) {
        timeInMinutes = parseInt((set[2] / 60).toFixed(2));
        temp = set[1];
        filtered.push([temp, timeInMinutes]);
      }
    })

    $chart.series[0].setData(filtered)
  })
<% end %>
