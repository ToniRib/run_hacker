<div class="container">
  <div class="row main-chart-area orange-border">
    <div class="col-sm-12">
      <div class="row text-center">
        <h2>Workout Listing</h2>
      </div>
      <div class="row table-section">

        <table class="table table-striped workouts-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Distance (mi)</th>
              <th>Average Speed (mph)</th>
              <th>Elapsed Time (min)</th>
              <th>Calories Burned (kcal)</th>
              <th>Location</th>
              <th>Elevation (feet)</th>
            </tr>
          </thead>
          <tbody>
            <% @user.workouts.by_descending_start_date.each do |workout| %>
              <tr class="clickable-row" id="workout-<%= workout.map_my_fitness_id %>" data-href="workouts">
                <td><%= workout.starting_date_no_time %></td>
                <td><%= workout.distance_in_miles %></td>
                <td><%= workout.average_speed_in_mph %></td>
                <td><%= workout.elapsed_time_in_minutes %></td>
                <td><%= workout.calories_burned_in_kcal %></td>
                <% if workout.location %>
                  <td><%= workout.location.city_and_state %></td>
                <% else %>
                  <td></td>
                <% end %>
                <td><%= workout.route.elevation_in_feet if workout.route %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  $(document).ready(function() {
    $(".clickable-row").click(function() {
        var workoutId = this.id.split("-")[1];

        var workoutUrl = "https://oauth2-api.mapmyapi.com/v7.1/workout/" + workoutId;
        $.ajax({
          type: "GET",
          url: workoutUrl,
          data: {
            "field_set": "time_series"
          },
          beforeSend: function(xhr) {
            xhr.setRequestHeader("Authorization", "Bearer <%= @user.token %>"),
            xhr.setRequestHeader("Api-Key", "<%= ENV['MMF_API_KEY'] %>")
          },
          success: function(workout) {
            console.log(workout);
          }
        })
    });
  });
<% end %>
