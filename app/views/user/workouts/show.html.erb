<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <%= link_to "<< Back to Workouts", workouts_path %>
    </div>
  </div>
  <div class="row orange-border">
    <div class="col-sm-12 col-md-5">
      <h2><%= @workout.starting_date_no_time %></h2>
      <ul class="individual-workout-stats">
        <li><h4><strong>Started At:</strong> <%= @workout.starting_time_only %></h4></li>
        <li><h4><strong>Distance:</strong> <%= @workout.distance_in_miles %> miles</h4></li>
        <li><h4><strong>Elapsed Time:</strong> <%= @workout.elapsed_time_in_minutes %> minutes</h4></li>
        <li><h4><strong>Temperature:</strong> <%= @workout.display_temperature %></h4></li>
        <li><h4><strong>Calories Burned:</strong> <%= @workout.calories_burned_in_kcal %> kcal</h4></li>
        <li><h4><strong>Average Speed:</strong> <%= @workout.average_speed_in_mph %> mph</h4></li>
        <li><h4><strong>Minimum Speed:</strong> <%= @time_series.min_speed_in_mph %> mph</h4></li>
        <li><h4><strong>Maximum Speed:</strong> <%= @time_series.max_speed_in_mph %> mph</h4></li>
        <li><h4><strong>Minimum Elevation:</strong> <%= @time_series.min_elevation_in_feet %> ft</h4></li>
        <li><h4><strong>Maximum Elevation:</strong> <%= @time_series.max_elevation_in_feet %> ft</h4></li>
      </ul>
    </div>
    <div class="col-sm-12 col-md-7">
      <div class="workout-map" id="google-map"></div>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  function initMap() {
    var startLatLng = {lat: <%= @time_series.points.first.lat %>,
                       lng: <%= @time_series.points.first.lng %>};

    var endLatLng = {lat: <%= @time_series.points.last.lat %>,
                     lng: <%= @time_series.points.last.lng %>};

    var centerLatLng = {lat: ((endLatLng.lat + startLatLng.lat) / 2),
                        lng: ((endLatLng.lng + startLatLng.lng) / 2)}

    var map = new google.maps.Map(document.getElementById('google-map'), {
      center: centerLatLng,
      zoom: 12
    });

    var startMarker = new google.maps.Marker({
      position: startLatLng,
      map: map,
      label: "S"
    });

    var endMarker = new google.maps.Marker({
      position: endLatLng,
      map: map,
      label: "E"
    });

    var routeCoordinates = <%= @time_series.route_coordinates.to_json.html_safe %>;

    var color = "#64eb06";
    for (var i = 0; i < routeCoordinates.length-1; i++) {
      var routePath = new google.maps.Polyline({
        path: [routeCoordinates[i],routeCoordinates[i+1]],
        geodesic: true,
        strokeColor: color,
        strokeOpacity: 0.5,
        strokeWeight: 4,
        map: map
      });
    }
  }
<% end %>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm1nN_vOXj6XM6U8rRNaBDAcprgDB1pkM&callback=initMap"
async defer></script>
